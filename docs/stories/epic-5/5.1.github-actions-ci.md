# Story 5.1: GitHub Actions CI Pipeline

## Status
Draft

## Story
**As a** developer,
**I want** automated CI/CD pipelines using GitHub Actions,
**so that** code quality is verified on every PR and deployments are automated.

## Acceptance Criteria
1. GitHub Actions workflow runs on every PR to main/master
2. Workflow runs linting (ESLint, Ruff) for both frontend and backend
3. Workflow runs type checking (TypeScript, mypy)
4. Workflow runs all tests (Vitest for web, pytest for API)
5. Workflow runs build for web app
6. Workflow fails if any check fails, blocking merge
7. PR shows status checks with clear pass/fail indicators

## Tasks / Subtasks

- [ ] **Task 1: Create CI Workflow File** (AC: 1, 6)
  - [ ] Create `.github/workflows/ci.yml`
  - [ ] Configure trigger on push to main and PR to main
  - [ ] Set up job matrix for Node.js and Python versions

- [ ] **Task 2: Configure Linting Jobs** (AC: 2)
  - [ ] Add ESLint step for apps/web
  - [ ] Add Ruff step for apps/api
  - [ ] Configure caching for node_modules and .venv

- [ ] **Task 3: Configure Type Checking Jobs** (AC: 3)
  - [ ] Add TypeScript type check for apps/web
  - [ ] Add mypy type check for apps/api

- [ ] **Task 4: Configure Test Jobs** (AC: 4)
  - [ ] Add Vitest run for apps/web
  - [ ] Add pytest run for apps/api
  - [ ] Configure test coverage reporting

- [ ] **Task 5: Configure Build Job** (AC: 5, 7)
  - [ ] Add Next.js build step
  - [ ] Configure build artifacts if needed
  - [ ] Add status badge to README

## Dev Notes

### Workflow Structure
```yaml
name: CI
on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]
jobs:
  lint:
    ...
  typecheck:
    ...
  test:
    ...
  build:
    needs: [lint, typecheck, test]
    ...
```

### Environment Variables
- Use GitHub Secrets for sensitive values
- NEXT_PUBLIC_* vars can be in workflow file

### Caching Strategy
- Cache pnpm store for faster installs
- Cache .venv for Python dependencies
- Cache .next/cache for faster builds

### References
- PRD NFR31: SAST tools shall run in CI
- PRD E0-S3: Configure CI pipeline

## Testing

### Verification
1. Create a test PR and verify all checks run
2. Introduce a lint error and verify CI fails
3. Introduce a type error and verify CI fails
4. Introduce a failing test and verify CI fails
5. Fix all issues and verify CI passes

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-18 | 0.1 | Initial story draft | Claude Opus 4.5 |

## Dev Agent Record

### Agent Model Used
(To be filled during implementation)

### Debug Log References
- N/A

### Completion Notes List
(To be filled during implementation)

### File List
**To Create:**
- .github/workflows/ci.yml

**To Modify:**
- README.md (add status badge)

## QA Results
(To be filled after implementation)

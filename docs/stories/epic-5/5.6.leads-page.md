# Story 5.6: Leads Management Page

## Status
Draft

## Story
**As a** user,
**I want** a leads management page to track and update lead statuses,
**so that** I can manage my sales pipeline and track conversion outcomes.

## Acceptance Criteria
1. Leads page displays at `/leads` route
2. Leads are displayed in a filterable, sortable table
3. User can filter leads by status, source, and date range
4. User can update lead status (New → Contacted → Responded → Converted → Lost)
5. User can update lead accuracy (Verified, Bounced, Invalid, Wrong Person)
6. Status changes are recorded with timestamps (audit trail)
7. Leads are scoped to active client profile

## Tasks / Subtasks

- [ ] **Task 1: Create Leads Page Layout** (AC: 1, 2, 7)
  - [ ] Create `apps/web/app/(dashboard)/leads/page.tsx`
  - [ ] Add page header with lead count
  - [ ] Create leads data table with columns
  - [ ] Display active client context

- [ ] **Task 2: Implement Filtering** (AC: 3)
  - [ ] Add status filter dropdown (All, New, Contacted, etc.)
  - [ ] Add source filter dropdown
  - [ ] Add date range picker
  - [ ] Add search by name/company

- [ ] **Task 3: Implement Sorting** (AC: 2)
  - [ ] Add sortable column headers
  - [ ] Support sorting by: score, status, created date, company
  - [ ] Remember sort preference

- [ ] **Task 4: Implement Status Update** (AC: 4, 6)
  - [ ] Create status dropdown in each row
  - [ ] Call API to update status on change
  - [ ] Show optimistic update with loading state
  - [ ] Display status history on hover/click

- [ ] **Task 5: Implement Accuracy Update** (AC: 5)
  - [ ] Create accuracy indicator/dropdown
  - [ ] Support: Verified, Email Bounced, Phone Invalid, Wrong Person, Company Mismatch
  - [ ] Visual indicators for accuracy issues

- [ ] **Task 6: Create Leads Store** (AC: 2-6)
  - [ ] Create `apps/web/stores/leads-store.ts`
  - [ ] Manage leads list with filtering/sorting
  - [ ] Handle status and accuracy updates
  - [ ] Support pagination

## Dev Notes

### Component Structure
```
apps/web/
├── app/(dashboard)/leads/
│   └── page.tsx
├── components/leads/
│   ├── leads-table.tsx
│   ├── leads-filters.tsx
│   ├── lead-row.tsx
│   ├── status-dropdown.tsx
│   ├── accuracy-badge.tsx
│   └── status-history.tsx
└── stores/
    └── leads-store.ts
```

### API Endpoints
- GET `/v1/leads` - List leads with filters
- GET `/v1/leads/{id}` - Get lead details with history
- PATCH `/v1/leads/{id}` - Update lead status/accuracy

### Lead Status Flow
```
New → Contacted → Responded → Converted
                           ↘ Lost
```

### Accuracy Values
- `verified` - Contact info confirmed working
- `email_bounced` - Email bounced back
- `phone_invalid` - Phone number doesn't work
- `wrong_person` - Reached wrong contact
- `company_mismatch` - Company info was incorrect

### References
- PRD FR42-FR46: Lead Tracking & Lifecycle
- PRD FR44-FR45: Accuracy tracking
- Data Model: Lead entity with status, accuracy, LeadStatusHistory

## Testing

### Verification
1. Navigate to /leads and verify page loads
2. Filter by status and verify results update
3. Sort by score and verify order
4. Update status and verify change persists
5. Update accuracy and verify indicator shows
6. View status history for a lead

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-18 | 0.1 | Initial story draft | Claude Opus 4.5 |

## Dev Agent Record

### Agent Model Used
(To be filled during implementation)

### Debug Log References
- N/A

### Completion Notes List
(To be filled during implementation)

### File List
**To Create:**
- apps/web/app/(dashboard)/leads/page.tsx
- apps/web/components/leads/leads-table.tsx
- apps/web/components/leads/leads-filters.tsx
- apps/web/components/leads/lead-row.tsx
- apps/web/components/leads/status-dropdown.tsx
- apps/web/components/leads/accuracy-badge.tsx
- apps/web/components/leads/status-history.tsx
- apps/web/components/leads/index.ts
- apps/web/stores/leads-store.ts

**To Modify:**
- apps/web/app/(dashboard)/layout.tsx (ensure /leads in nav)

## QA Results
(To be filled after implementation)

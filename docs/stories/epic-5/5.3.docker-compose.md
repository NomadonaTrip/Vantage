# Story 5.3: Docker Compose for Local Development

## Status
Draft

## Story
**As a** developer,
**I want** a Docker Compose setup for local development,
**so that** I can run the full stack (PostgreSQL, Redis) without manual service installation.

## Acceptance Criteria
1. `docker-compose up` starts PostgreSQL and Redis services
2. PostgreSQL is accessible on localhost:5432 with configured credentials
3. Redis is accessible on localhost:6379
4. Data persists across container restarts via volumes
5. Environment variables are documented in .env.example
6. Health checks ensure services are ready before use

## Tasks / Subtasks

- [ ] **Task 1: Create Docker Compose File** (AC: 1, 6)
  - [ ] Create `docker-compose.yml` in project root
  - [ ] Configure PostgreSQL service with health check
  - [ ] Configure Redis service with health check

- [ ] **Task 2: Configure PostgreSQL** (AC: 2, 4)
  - [ ] Set up postgres:16 image
  - [ ] Configure environment variables for credentials
  - [ ] Set up volume for data persistence
  - [ ] Expose port 5432

- [ ] **Task 3: Configure Redis** (AC: 3, 4)
  - [ ] Set up redis:7 image
  - [ ] Configure persistence (AOF)
  - [ ] Expose port 6379

- [ ] **Task 4: Environment Configuration** (AC: 5)
  - [ ] Update .env.example with Docker connection strings
  - [ ] Document local vs Docker connection differences
  - [ ] Add docker-compose commands to README

## Dev Notes

### Docker Compose Structure
```yaml
version: '3.8'
services:
  postgres:
    image: postgres:16
    environment:
      POSTGRES_USER: vantage
      POSTGRES_PASSWORD: vantage_dev
      POSTGRES_DB: vantage
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U vantage"]
      interval: 5s
      timeout: 5s
      retries: 5

  redis:
    image: redis:7
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    command: redis-server --appendonly yes
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 5s
      timeout: 5s
      retries: 5

volumes:
  postgres_data:
  redis_data:
```

### Connection Strings
```
DATABASE_URL=postgresql://vantage:vantage_dev@localhost:5432/vantage
REDIS_URL=redis://localhost:6379
```

### References
- PRD E0-S9: Configure Docker Compose for local dev
- PRD NFR: System shall support Redis for caching and Celery broker

## Testing

### Verification
1. Run `docker-compose up -d` and verify services start
2. Connect to PostgreSQL with psql or DBeaver
3. Connect to Redis with redis-cli
4. Stop and restart containers, verify data persists
5. Run `docker-compose down -v` to clean up

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-18 | 0.1 | Initial story draft | Claude Opus 4.5 |

## Dev Agent Record

### Agent Model Used
(To be filled during implementation)

### Debug Log References
- N/A

### Completion Notes List
(To be filled during implementation)

### File List
**To Create:**
- docker-compose.yml

**To Modify:**
- .env.example (add Docker connection strings)
- README.md (add Docker commands)

## QA Results
(To be filled after implementation)
